# =============================================================================
# TMUX Configuration
# Modern, minimal tmux setup with mouse support and custom status line
# =============================================================================

# -----------------------------------------------------------------------------
# General Settings
# -----------------------------------------------------------------------------

# Change prefix from C-b to C-a (more ergonomic, Screen-style)
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Enable 256 color support
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Increase scrollback buffer size
set -g history-limit 10000

# Start window and pane numbering at 1 (0 is too far)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Reduce escape time (important for vim/neovim)
set -sg escape-time 10

# Enable mouse support
set -g mouse on

# Set window notifications
setw -g monitor-activity on
set -g visual-activity off

# -----------------------------------------------------------------------------
# Key Bindings
# -----------------------------------------------------------------------------

# Reload config file
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# Session manager (sesh + fzf)
bind s run-shell 'sesh connect "$(sesh list | fzf-tmux -p 80%,70%)"'

# Split panes using | and - (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Create new window in current path
bind c new-window -c "#{pane_current_path}"

# Navigate panes with Alt+arrow (no prefix needed)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Resize panes with Prefix + arrow keys
bind -r Left resize-pane -L 5
bind -r Right resize-pane -R 5
bind -r Up resize-pane -U 5
bind -r Down resize-pane -D 5

# Quick pane cycling
bind -r Tab select-pane -t :.+

# -----------------------------------------------------------------------------
# Copy Mode Settings
# -----------------------------------------------------------------------------

# Use vi mode for copy mode
setw -g mode-keys vi

# Copy mode bindings
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle

# Enter copy mode with Prefix + [
bind [ copy-mode

# -----------------------------------------------------------------------------
# Status Bar - Dark Modern Theme
# -----------------------------------------------------------------------------

# Status bar position
set -g status-position bottom

# Update status bar every 5 seconds
set -g status-interval 5

# Status bar length
set -g status-left-length 40
set -g status-right-length 100

# Color scheme - Dark Modern
set -g status-style bg=#1e1e2e,fg=#cdd6f4

# Left side: Session name
set -g status-left "#[bg=#89b4fa,fg=#1e1e2e,bold] #S #[bg=#1e1e2e,fg=#89b4fa] "

# Window status format
set -g window-status-format "#[fg=#6c7086] #I:#W "
set -g window-status-current-format "#[bg=#89b4fa,fg=#1e1e2e,bold] #I:#W #[bg=#1e1e2e,fg=#89b4fa]"

# Window status separator
set -g window-status-separator ""

# Right side: System info and time
set -g status-right "#[fg=#6c7086]#[fg=#cdd6f4,bg=#313244] 󰍛 %Y-%m-%d #[fg=#89b4fa,bg=#313244]#[fg=#1e1e2e,bg=#89b4fa,bold] 󰥔 %H:%M "

# Pane border colors
set -g pane-border-style fg=#313244
set -g pane-active-border-style fg=#89b4fa

# Message styling
set -g message-style bg=#89b4fa,fg=#1e1e2e,bold
set -g message-command-style bg=#313244,fg=#cdd6f4

# -----------------------------------------------------------------------------
# Window & Pane Settings
# -----------------------------------------------------------------------------

# Auto-create 3 panes on new sessions
# Layout: Right 20%, Left 80% split (top 80%, bottom 20%)
set-hook -g session-created 'split-window -h -p 20 -c "#{pane_current_path}" ; select-pane -L ; split-window -v -p 20 -c "#{pane_current_path}" ; select-pane -U'

# Automatic window renaming
setw -g automatic-rename on
set -g set-titles on
set -g set-titles-string "#T"

# Pane synchronization toggle
bind S setw synchronize-panes \; display "Synchronize panes: #{?pane_synchronized,ON,OFF}"

# -----------------------------------------------------------------------------
# Plugin Manager (TPM) - Session Persistence
# -----------------------------------------------------------------------------
# Install TPM:
#   git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
# Then press Prefix + I to install plugins.

# Plugin list (keep TPM first, continuum last)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Auto-restore on tmux server start (requires tmux-continuum)
set -g @continuum-restore 'on'

# Save interval (minutes).
set -g @continuum-save-interval '15'

# Initialize TPM (keep this at the very bottom)
run '~/.tmux/plugins/tpm/tpm'
